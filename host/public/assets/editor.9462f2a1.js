import{_ as f,k as r,c as a,V as C,cj as w,f as c,d as p,F as _,g as b,N as y,M as $,h as x,K as M,L as S,j as g,l as v}from"./index.2bd1149f.js";function I(e="",t=4){return e.normalize("NFD").replace(/[ \u0300-\u036f]/g,"").toUpperCase().substr(0,10)+([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,l=>(l^crypto.getRandomValues(new Uint8Array(1))[0]&15>>l/4).toString(16)).substr(0,t)}const D={props:{value:{default:"",type:String},index:{default:0,type:Number}},data(){return{refresh:0,editable:!1,content:"",styles:"text-lg outline",tip:!1}},watch:{value(){this.content=this.value,this.$refs.edit.textContent=this.content}},mounted(){this.content=this.value,this.$refs.edit.textContent=this.content},methods:{focus(){console.log("focus"),this.editable=!0,this.$nextTick(()=>{this.$refs.edit.focus()}),this.$emit("hideMenu",this.$refs.edit)},blur(){console.log("blur"),this.editable=!1,this.content.trim()==""&&(this.content="",this.tip=!1)},keydown(e){console.log(e),this.tip=!1,e.key=="@"?(console.log("@"),this.$emit("showMenu",this.$refs.edit)):this.$emit("hideMenu",this.$refs.edit)},keyup(e){console.log(e),this.content=this.$refs.edit.textContent,this.$emit("onChange",{value:this.content,index:this.index}),console.log("this.content",this.content),this.content.indexOf("\u2328\uFE0F")!=-1&&(this.content.replaceAll("\u2328\uFE0F",""),this.$refs.edit.textContent=this.content)},addText(){this.editable=!0,this.content=" ",this.$refs.edit.textContent=" ",this.$forceUpdate(),this.$nextTick(()=>{this.$refs.edit.focus()}),this.tip=!0}}},P={class:""},R=["contenteditable"],T=c("i",{class:"iconify inline-block","data-icon":"mdi:dots-horizontal"},null,-1),N=[T],B={key:1},V=c("i",{class:"iconify inline-block","data-icon":"eos-icons:typing"},null,-1),A=[V];function E(e,t,n,l,s,o){return r(),a("span",P,[C(c("span",{ref:"edit",contenteditable:s.editable,onClick:t[0]||(t[0]=(...i)=>o.focus&&o.focus(...i)),onBlur:t[1]||(t[1]=(...i)=>o.blur&&o.blur(...i)),onKeydown:t[2]||(t[2]=(...i)=>o.keydown&&o.keydown(...i)),onKeyup:t[3]||(t[3]=(...i)=>o.keyup&&o.keyup(...i)),class:"outline-none"},null,40,R),[[w,s.content!=""]]),s.content==""?(r(),a("span",{key:0,class:"border rounded-lg cursor-pointer",onClick:t[4]||(t[4]=(...i)=>o.addText&&o.addText(...i))},N)):p("",!0),s.tip?(r(),a("span",B,A)):p("",!0)])}var F=f(D,[["render",E]]);const O={data(){return{visible:!1,posX:110,posY:110,caretPos:0,lastIndex:0,values:[{label:"Nome do participante",value:"nome"},{label:"Nome da trilha",value:"nomeTrilha"},{label:"Data da trilha",value:"dataTrilha"},{label:"Data de emiss\xE3o",value:"dataEmissao"},{label:"\xC1rea de conhecimento",value:"area"},{label:"Per\xEDodo",value:"periodo"},{label:"Carga hor\xE1ria",value:"ch"}]}},mounted(){let e=this;document.body.addEventListener("click",t=>{let n=e.$refs.menu1;n!=null&&(n==t.target||n.contains(t.target)||(e.visible=!1))})},methods:{handleFocus(){console.log("handleFocus")},handleFocusOut(){console.log("handleFocusOut")},getCaretTopPoint(){const t=document.getSelection().getRangeAt(0);let n,l;const s=t.startContainer,o=t.startOffset;if(o>0)return l=document.createRange(),l.setStart(s,o-1),l.setEnd(s,o),n=l.getBoundingClientRect(),{left:n.right,top:n.top};if(o<s.length)return l=document.createRange(),l.setStart(s,o),l.setEnd(s,o+1),n=l.getBoundingClientRect(),{left:n.left,top:n.top};{n=s.getBoundingClientRect();const i=getComputedStyle(s),d=parseInt(i.lineHeight),m=parseInt(i.fontSize),u=(d-m)/2;return{left:n.left,top:n.top+u}}},cursorPosition(){const e=document.getSelection();e.modify("extend","backward","paragraphboundary");const t=e.toString().length;return e.anchorNode!==void 0&&e.collapseToEnd(),t},show(e){this.visible=!0,this.lastID=e;let t=this.getCaretTopPoint();console.log("cursor",t);let n=this.cursorPosition();this.caretPos=n,console.log("caretPos",n),this.posX=parseInt(t.left),this.posY=parseInt(t.top+20)},hide(){this.visible=!1},clickItem(e,t){console.log("clickItem",{e,elem:t}),this.$emit("addMention",{elem:t,insertID:this.lastID,caretPos:this.caretPos}),this.visible=!1,e.preventDefault()}}},z={key:0},H=["onClick"];function L(e,t,n,l,s,o){return s.visible?(r(),a("div",z,[c("div",{ref:"menu1",class:"z-[1000] border p-2 rounded absolute bg-white",style:$(`top:${s.posY}px; left:${s.posX}px;`)},[(r(!0),a(_,null,b(s.values,(i,d)=>(r(),a("div",{key:d},[c("div",{onClick:m=>o.clickItem(m,i),class:"py-0.5 px-2 my-0.5 bg-gray-100 hover:bg-gray-200 border rounded cursor-pointer"},y(i.label),9,H)]))),128))],4)])):p("",!0)}var U=f(O,[["render",L]]);const j={props:{item:{default:null,type:Object}},data(){return{menuShow:!1}},mounted(){},methods:{excluir(e,t){this.$emit("remove",t),this.menuShow=!1}}},K={if:"item!=null"},X={class:"px-[1px] mx-[2px] font-medium border rounded bg-yellow-200 text-orange-600"},Y=c("i",{class:"iconify inline-block","data-icon":"mdi:remove-circle"},null,-1),Q=c("span",{class:"ml-1"},"excluir",-1),q=[Y,Q];function G(e,t,n,l,s,o){return r(),a("span",K,[c("span",X,y(n.item.label),1),x(S,{modelValue:s.menuShow,"onUpdate:modelValue":t[1]||(t[1]=i=>s.menuShow=i)},{default:M(()=>[c("div",{onClick:t[0]||(t[0]=i=>o.excluir(i,n.item)),class:"flex items-center px-1 m-0.5 text-xs text-white bg-red-500 hover:bg-red-600 border rounded cursor-pointer"},q)]),_:1},8,["modelValue"])])}var J=f(j,[["render",G]]);const W={components:{mtext:F,mmenu:U,mention:J},props:{contents:{default:[],type:Array}},data(){return{refresh:0,menu:!1,elems:[{type:"edit",value:""}],lastElem:null}},watch:{contents(){this.elems=this.contents,this.elems.length==0&&this.elems.push({type:"edit",value:""})}},mounted(){this.elems=this.contents,this.elems.length==0&&this.elems.push({type:"edit",value:""})},methods:{onChange(e){console.log("onChange",e),this.elems[e.index].value=e.value,this.$emit("onChange",this.elems)},showMenu(e){console.log("showMenu",e),this.$refs.mmenu.show(e)},hideMenu(){console.log("menuHide"),this.$refs.mmenu.hide()},addMention(e){console.log("addMention",e);let t={item:e.elem,type:"mention",id:I()};console.log("newItem",t);let n=this.elems[e.insertID],l=n.value.substr(0,e.caretPos).trim(),s=n.value.substr(e.caretPos).trim();s.charAt(0)=="@"&&(s=s.substr(1)),console.log({textLeft:l,textRight:s}),this.elems.splice(e.insertID,1,{type:"edit",value:l}),this.elems.splice(e.insertID+1,0,t),this.elems.splice(e.insertID+2,0,{type:"edit",value:s}),console.log("this.elems",this.elems),this.refresh++,this.$forceUpdate(),this.$emit("onChange",this.elems)},removeMention(e){if(console.log("removeMention",e),e>0&&e<this.elems.length){let t=this.elems[e-1],n=this.elems[e+1];console.log({elemLeft:t,elemRight:n});let l=t.value.trim()+n.value.trim();this.elems.splice(e-1,3,{type:"edit",value:l})}else this.elems.splice(e,1);this.$emit("onChange",this.elems)},getContents(){return this.elems}}},Z={class:"border p-2 rounded"},ee={key:0},te={key:1,class:"cursor-pointer"};function se(e,t,n,l,s,o){const i=g("mtext"),d=g("mention"),m=g("mmenu");return r(),a("div",Z,[(r(!0),a(_,null,b(s.elems,(u,h)=>(r(),a("span",{key:h},[u.type=="edit"?(r(),a("span",ee,[(r(),v(i,{index:h,value:u.value,onOnChange:o.onChange,onShowMenu:k=>o.showMenu(h),onHideMenu:o.hideMenu,key:s.refresh+h},null,8,["index","value","onOnChange","onShowMenu","onHideMenu"]))])):p("",!0),u.type=="mention"?(r(),a("span",te,[(r(),v(d,{item:u.item,onRemove:k=>o.removeMention(h),key:s.refresh+h},null,8,["item","onRemove"]))])):p("",!0)]))),128)),x(m,{ref:"mmenu",onAddMention:o.addMention},null,8,["onAddMention"])])}var oe=f(W,[["render",se]]);export{oe as e,I as n};
